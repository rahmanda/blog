<!DOCTYPE html>
<html lang="id">
  <head>
    <title>Membuat Tweepy dengan Flask - Episode 2</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet">
    
<link href="/client.build.bcf49eda2efc4f8ad679.css" rel="stylesheet">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="bg-indigo h-1"></div> <nav class="max-w-md mx-auto py-2 px-8 text-base whitespace-nowrap overflow-y-auto"><a href="/" class="mr-4">Home</a> <a href="https://id.linkedin.com/in/rahmandawibowo" class="mr-4">About</a></nav> <main role="main"><section class="post"><h1>Membuat Tweepy dengan Flask - Episode 2</h1> <!----> <div class="text-sm mb-8 text-grey-darker"><time datetime="2015-11-22">
        22 November 2015
      </time> <span class="mx-1">•</span> <span title="4 min read">4 min read</span></div> <article><p>Pada tutorial Flask episode kali ini kita akan menambahkan beberapa fungsi baru seperti lihat profil dan <em>follow</em> akun lain. Pertama-tama ada beberapa hal yang harus kita edit dari kode pada episode sebelumnya.  </p>
<h2 id="edit-kodingan">Edit Kodingan</h2>
<p>Karena kita ingin menambahkan fitur <em>follow</em>, <em>timeline</em> kita harus bisa menampilkan juga <em>tweet-tweet</em> dari akun yang kita <em>follow</em>. Edit fungsi <em>route</em> <code>timeline</code> dan <code>register</code> pada <code>tweepy.py</code> seperti dibawah ini:  </p>
<pre><code>@app.route(&#39;/timeline/&#39;)
def timeline():
  if &#39;user_id&#39; not in session:
    return redirect(url_for(&#39;public_timeline&#39;))

  return render_template(&#39;timeline.html&#39;, tweets=query_db(&#39;&#39;&#39;
    select tweets.*, users.* from users
    inner join tweets on (tweets.user_id=users.id)
    where users.id in (select user_id from followers where follower_id=?)
    order by tweets.pub_date desc limit ?&#39;&#39;&#39;,
    [session[&#39;user_id&#39;], app.config[&#39;PER_PAGE&#39;]]), test=query_db(&#39;&#39;&#39;
    select * from users where username = &#39;ambercat&#39;
    &#39;&#39;&#39;))

...
...

@app.route(&#39;/register&#39;, methods=[&#39;POST&#39;])
def register():
  if &#39;user_id&#39; in session:
    return redirect(url_for(&#39;timeline&#39;))
  error = None
  if request.method == &#39;POST&#39;:
    if not request.form[&#39;username&#39;]:
      error = &#39;Please enter your username&#39;
    elif not request.form[&#39;fullname&#39;]:
      error = &#39;Please enter your fullname&#39;
    elif not request.form[&#39;password&#39;]:
      error = &#39;Please enter your password&#39;
    elif request.form[&#39;password&#39;] != request.form[&#39;password2&#39;]:
      error = &#39;The two password that you entered didn\&#39;t match&#39;
    elif get_user_id(request.form[&#39;username&#39;]) is not None:
      error = &#39;The username is already taken&#39;
    else:
      db = connect_db()
      db.execute(&#39;&#39;&#39;insert into users (
        username, fullname, password) values (?, ?, ?)&#39;&#39;&#39;,
        (request.form[&#39;username&#39;], request.form[&#39;fullname&#39;],
         generate_password_hash(request.form[&#39;password&#39;])))
      db.commit()
      user_id = get_user_id(request.form[&#39;username&#39;])
      db.execute(&#39;insert into followers (user_id, follower_id) values (?, ?)&#39;,
        (user_id, user_id))
      db.commit()
      db.close()
      flash(&#39;You were successfully registered&#39;)
      return redirect(url_for(&#39;login&#39;))</code></pre><p>Pada kode fungsi <code>register</code>, kita harus menyimpan data <em>follower</em> pertama, yaitu akun kita sendiri XD. Sehingga pada fungsi <em>timeline</em>, kita bisa menampilkan <em>tweet</em> kita sendiri dan akun yang kita follow. Setelah dilakukan penambahan, <em>query</em> pada fungsi <em>timeline</em> menjadi lebih kompleks dari sebelumnya karena melibatkan <code>INNER JOIN</code> dengan tabel <code>tweets</code>.  </p>
<h2 id="menambahkan-route-untuk-profil-dan-follow">Menambahkan Route untuk Profil dan Follow</h2>
<p>Masih pada <code>tweepy.py</code>, ketik kode di bawah ini setelah fungsi <code>logout</code>:  </p>
<pre><code>@app.route('/profile/<span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>')
def profile(username):
  if 'user_id' not in session:
    return redirect(url_for('public_timeline'))
  return render_template('timeline.html', tweets=query_db('''
    select * from users inner join tweets on (users.id = tweets.user_id)
    where users.username = ?''',
    [username]), user_data=get_user_data(username),
    followed=is_followed(get_user_id(username), session['user_id']))

@app.route('/follow/<span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>')
def follow(username):
  if 'user_id' not in session:
    abort(401)
  db = connect_db()
  db.execute('''insert into followers (user_id, follower_id)
    values (?, ?)''', (get_user_id(username), session['user_id']))
  db.commit()
  db.close()
  flash('You have successfully followed @%s', username)
  return redirect(url_for('profile', username=username))

@app.route('/unfollow/<span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>')
def unfollow(username):
  if 'user_id' not in session:
    abort(401)
  db = connect_db()
  db.execute('''delete from followers where user_id = ? and follower_id = ?''',
    (get_user_id(username), session['user_id']))
  db.commit()
  db.close()
  flash('You have successfully unfollowed @%s', username)
  return redirect(url_for('profile', username=username))</code></pre><p>Pada fungsi <em>follow</em> dan <em>unfollow</em> hanya melakukan <em>query database</em> saja, sedangkan pada fungsi <em>profile</em>, kita melakukan <code>render_template</code>. Selanjutnya kita perlu meng-<em>update template</em> <code>timeline</code>.  </p>
<h2 id="update-template-timeline">Update template timeline</h2>
<p><em>Update</em> <code>timeline.html</code> di <em>folder</em> <code>templates</code> sehingga seperti kode di bawah ini:  </p>
<pre><code class="language-html">{% extends "layout.html" %}
{% block title %}
  {% if request.endpoint == 'public_timeline' %}
    Public Timeline
  {% else %}
    My Timeline
  {% endif %}
{% endblock %}
{% block body %}
{% include "nav.html" %}
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tweet-box"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"POST"</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"{{ url_for('add_tweet') }}"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"tweet"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Apa yang anda pikirkan saat ini?"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Tweet"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-tweet"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    {% if request.endpoint == 'profile' %}
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"action"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"profile"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fullname"</span>&gt;</span>{{ user_data.fullname }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"username"</span>&gt;</span>@{{ user_data.username }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      {% if 'user_id' in session %}
        {% if session['user_id'] != user_data.id %}
          {% if followed %}
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"{{ url_for('unfollow', username=user_data.username) }}"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-unfollow"</span>&gt;</span>Unfollow<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          {% else %}
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"{{ url_for('follow', username=user_data.username) }}"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-follow"</span>&gt;</span>
          Follow<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          {% endif %}
        {% endif %}
      {% endif %}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    {% endif %}
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"timeline"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span>&gt;</span>Timeline<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    {% for tweet in tweets %}
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tweet-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fullname"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"{{ url_for('profile', username=tweet.username) }}"</span>&gt;</span>{{ tweet.fullname }}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"username"</span>&gt;</span>@{{ tweet.username }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tweet"</span>&gt;</span>{{ tweet.tweet }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pub_date"</span>&gt;</span>{{ tweet.pub_date }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    {% endfor %}
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
{% endblock %}</code></pre>
<p>Kita menambahkan kondisi, apabila <code>request</code> berasal dari <em>route</em> <code>profile</code>, maka <em>template</em> akan menampilkan nama dan <em>username</em> akun, dan tombol <em>follow/unfollow</em>. Setelah itu, <em>generate database</em> dan jalankan web dengan perintah <code>python tweepy.py</code> di <code>console</code> (lihat episode sebelumnya untuk instruksi lengkapnya). Daftarkan dua akun yang berbeda, buat beberapa <em>tweet</em> pada akun tersebut, lalu pergi ke halaman profil akun lain dengan memasukkan url <code>localhost:5000/profil/&lt;username&gt;</code>. Jangan lupa coba tombol <em>follow</em>-nya. Sekarang <em>tweet-tweet</em> akun yang kamu <em>follow</em> akan tampil pada timeline kamu :).  </p>
<h2 id="selanjutnya">Selanjutnya?</h2>
<p>Pada episode selanjutnya, kita akan menambahkan fitur <em>search</em> sehingga kamu tidak perlu susah-susah mengingat <em>username</em>-nya. Selain itu kita juga akan melakukan <em>finishing</em> tampilan tweepy. Apabila kamu punya pertanyaan seputar tutorial ini, jangan sungkan bertanya melalui kolom komentar. Semoga artikel ini bermanfaat!</p>
<p><a href="https://github.com/rahmanda/ambercat-tweepy/tree/part-2">Source code</a>.</p>
</article></section> <footer class="flex flex-col md:flex-row max-w-md mx-auto my-8"><div class="flex-1 px-6 pb-8 text-left"><p class="mb-2 text-grey-dark">Older Post</p> <a href="/laragon-xampp-rasa-laravel.html">← Laragon - XAMPP Rasa Laravel</a></div> <div class="flex-1 px-6 pb-8 text-left md:text-right"><p class="mb-2 text-grey-dark">Newer Post</p> <a href="/membuat-tweepy-dengan-flask-3.html">Membuat Tweepy dengan Flask - Episode 3 →</a></div></footer></main></div>
    
<script src="/client.build.ea0a2031f2680983b234.js" type="text/javascript"></script>
    <div id="disqus_thread" class="max-w-md mx-auto px-8 py-12"></div>
    <script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname = 'ambercatbyrahmanda'; // required: replace example with your forum shortname

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
    </noscript>

  </body>
</html>
